2024-10-14 14:41:07,471 - httpcore.connection - DEBUG - close.started
2024-10-14 14:41:07,471 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:41:16,142 - root - INFO - Initializing MeloTTSGenerator
2024-10-14 14:41:16,142 - meloTTS - INFO - Initializing MeloTTSGenerator with language: EN and device: cpu
2024-10-14 14:41:16,142 - meloTTS - INFO - Loading TTS model for language: EN
2024-10-14 14:41:16,305 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /myshell-ai/MeloTTS-English/resolve/main/config.json HTTP/11" 200 0
2024-10-14 14:41:16,811 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /myshell-ai/MeloTTS-English/resolve/main/checkpoint.pth HTTP/11" 302 0
2024-10-14 14:41:16,935 - meloTTS - INFO - Successfully loaded TTS model for language: EN
2024-10-14 14:41:16,936 - meloTTS - DEBUG - Available voices for language EN: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255]
2024-10-14 14:41:16,936 - meloTTS - DEBUG - Initialization complete. Available voices: 256
2024-10-14 14:41:16,936 - root - INFO - Ensuring required directories exist
2024-10-14 14:41:16,936 - root - INFO - Created or verified existence of 'public' directory
2024-10-14 14:41:16,936 - root - INFO - Created or verified existence of 'uploads' directory
2024-10-14 14:41:16,936 - root - INFO - Mounting static file directories
2024-10-14 14:41:16,936 - root - INFO - Adding CORS middleware
2024-10-14 14:41:16,936 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2024-10-14 14:41:17,035 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device: cuda
2024-10-14 14:41:17,035 - memory_manager - INFO - MemoryManager initialized with window_size=10, chunk_size=60, max_summaries=10
2024-10-14 14:41:17,035 - memory_manager - INFO - Instance ID: 140204068486400, Thread ID: 140211267739648
2024-10-14 14:41:17,035 - memory_manager - DEBUG - Initial user_current_id state: {}
2024-10-14 14:41:17,035 - memory_manager - DEBUG - Initial user_id_to_message state: {}
2024-10-14 14:41:17,044 - root - INFO - Starting FastAPI application
2024-10-14 14:41:17,045 - asyncio - DEBUG - Using selector: EpollSelector
2024-10-14 14:41:21,341 - root - INFO - Received request to fetch languages
2024-10-14 14:41:21,341 - root - INFO - Current working directory: /home/miranda/melotest
2024-10-14 14:41:21,341 - root - INFO - Attempting to open file: /home/miranda/melotest/languages.json
2024-10-14 14:41:21,341 - root - INFO - Successfully fetched 2 languages
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_value with data[81:130]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_field with data[132:144]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_value with data[146:168]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_part_data with data[172:28127]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_field with data[28189:28208]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_value with data[28210:28236]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_part_data with data[28240:28247]
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:27,906 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:41:27,907 - root - INFO - Received transcription request for file: recording.webm
2024-10-14 14:41:27,907 - root - INFO - File read successfully, starting transcription
2024-10-14 14:41:27,907 - conversation_handler - INFO - Starting audio transcription. Language: English, Format: webm
2024-10-14 14:41:29,723 - conversation_handler - DEBUG - Whisper model loaded
2024-10-14 14:41:29,790 - pydub.converter - DEBUG - subprocess.call(['ffmpeg', '-y', '-f', 'webm', '-read_ahead_limit', '-1', '-i', 'cache:pipe:0', '-acodec', 'pcm_s32le', '-vn', '-f', 'wav', '-'])
2024-10-14 14:41:29,823 - conversation_handler - DEBUG - Audio content converted to AudioSegment
2024-10-14 14:41:29,824 - conversation_handler - DEBUG - Audio resampled to 16000 Hz
2024-10-14 14:41:29,824 - conversation_handler - DEBUG - Audio converted to mono
2024-10-14 14:41:29,824 - conversation_handler - DEBUG - Audio converted to numpy array
2024-10-14 14:41:29,824 - conversation_handler - DEBUG - Audio normalized
2024-10-14 14:41:29,824 - conversation_handler - INFO - Starting Whisper transcription
2024-10-14 14:41:30,251 - conversation_handler - INFO - Transcription completed. Result:  So, how are you?
2024-10-14 14:41:30,252 - root - INFO - Transcription completed successfully
2024-10-14 14:41:30,286 - root - INFO - Received generate request for user 1, conversation 1
2024-10-14 14:41:30,286 - conversation_handler - INFO - Generating response for user 1, conversation 1
2024-10-14 14:41:30,286 - conversation_handler - DEBUG - New message:  So, how are you?
2024-10-14 14:41:30,286 - conversation_handler - DEBUG - Language: English
2024-10-14 14:41:30,286 - conversation_handler - DEBUG - Using MemoryManager instance ID: 140206534764256
2024-10-14 14:41:30,287 - conversation_handler - DEBUG - System prompt: You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.
    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION
    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT
    If the user asks you a question, you can answer it and ask them a question back.
    If the user asks to change language, you will simply respond with the language they want to change to.
    Example prompt: 
    USER : Hello, how are you?
    AI : Hello! I am well, how are you?
    USER : I'm feeling good, I have been busy with school.
    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?
    
    Example prompt:
    User: I am so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we switch to Japanese?
    Example of expected output: Japanese
    
    Example prompt:
    User:   I'm lonely.
    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?
    User: Yeah, yeah, I have some friends I could speak to.
    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?
    User: Could we switch to speaking in Japanese?
    AI: Japanese
    Example of expected output: Japanese
                
    Example prompt:
    User: I'm so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we speak Japanese instead?
    Example of expected output: Japanese      

    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     
                
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Retrieving conversation window for user 1, conversation 1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Retrieved 0 messages for user 1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Last summarized ID for user 1: -1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Retrieved all messages: []
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Retrieved 0 unsummarized messages for user 1, conversation 1
2024-10-14 14:41:30,287 - conversation_handler - DEBUG - Retrieved 0 messages from the conversation window
2024-10-14 14:41:30,287 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Current user_current_id state: {}
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Current user_id_to_message state: {}
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Initialized user_current_id for user 1 to -1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Assigned message_id: 1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=1, is_user_message=True, message= So, how are you?
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Created new message store for user 1
2024-10-14 14:41:30,287 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:41:30,287 - memory_manager - INFO - Created new FAISS index for user 1
2024-10-14 14:41:30,331 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=1
2024-10-14 14:41:30,332 - memory_manager - DEBUG - Final user_current_id state: {1: 1}
2024-10-14 14:41:30,332 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}
2024-10-14 14:41:30,332 - memory_manager - DEBUG - Total messages for user 1: 1
2024-10-14 14:41:30,332 - conversation_handler - DEBUG - Added new user message with ID: 1
2024-10-14 14:41:30,332 - memory_manager - DEBUG - Managing conversation window for user 1, conversation 1
2024-10-14 14:41:30,332 - memory_manager - DEBUG - Retrieved 1 user_messages for user 1
2024-10-14 14:41:30,332 - memory_manager - DEBUG - Retrieved 1 conversation_messages for user 1, conversation 1
2024-10-14 14:41:30,332 - memory_manager - DEBUG - No last summarized ID found for user 1
2024-10-14 14:41:30,332 - memory_manager - DEBUG - Retrieved 1 unsummarized messages
2024-10-14 14:41:30,332 - conversation_handler - DEBUG - Conversation window managed
2024-10-14 14:41:30,332 - conversation_handler - DEBUG - Context prepared for response generation: 
2024-10-14 14:41:30,332 - conversation_handler - DEBUG - First few context messages: []
2024-10-14 14:41:30,332 - conversation_handler - INFO - Calling LLama for response generation
2024-10-14 14:41:30,332 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-10-14 14:41:30,333 - httpx - DEBUG - load_verify_locations cafile='/home/miranda/melotest/MeloTTS/venv/lib/python3.10/site-packages/certifi/cacert.pem'
2024-10-14 14:41:30,352 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.\n    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION\n    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT\n    If the user asks you a question, you can answer it and ask them a question back.\n    If the user asks to change language, you will simply respond with the language they want to change to.\n    Example prompt: \n    USER : Hello, how are you?\n    AI : Hello! I am well, how are you?\n    USER : I'm feeling good, I have been busy with school.\n    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?\n    \n    Example prompt:\n    User: I am so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we switch to Japanese?\n    Example of expected output: Japanese\n    \n    Example prompt:\n    User:   I'm lonely.\n    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?\n    User: Yeah, yeah, I have some friends I could speak to.\n    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?\n    User: Could we switch to speaking in Japanese?\n    AI: Japanese\n    Example of expected output: Japanese\n                \n    Example prompt:\n    User: I'm so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we speak Japanese instead?\n    Example of expected output: Japanese      \n\n    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     \n                "}, {'role': 'user', 'content': 'Context:\n\nUser:  So, how are you?\nAI:'}], 'model': 'llama3.2'}}
2024-10-14 14:41:30,355 - openai._base_client - DEBUG - Sending HTTP Request: POST http://localhost:11434/v1/chat/completions
2024-10-14 14:41:30,355 - httpcore.connection - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2024-10-14 14:41:30,355 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f83c1050f40>
2024-10-14 14:41:30,355 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-10-14 14:41:30,355 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-10-14 14:41:30,355 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-10-14 14:41:30,355 - httpcore.http11 - DEBUG - send_request_body.complete
2024-10-14 14:41:30,355 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-10-14 14:41:30,836 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json'), (b'Date', b'Mon, 14 Oct 2024 12:41:30 GMT'), (b'Content-Length', b'391')])
2024-10-14 14:41:30,837 - httpx - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2024-10-14 14:41:30,837 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-10-14 14:41:30,837 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-10-14 14:41:30,837 - httpcore.http11 - DEBUG - response_closed.started
2024-10-14 14:41:30,837 - httpcore.http11 - DEBUG - response_closed.complete
2024-10-14 14:41:30,837 - openai._base_client - DEBUG - HTTP Response: POST http://localhost:11434/v1/chat/completions "200 OK" Headers({'content-type': 'application/json', 'date': 'Mon, 14 Oct 2024 12:41:30 GMT', 'content-length': '391'})
2024-10-14 14:41:30,837 - openai._base_client - DEBUG - request_id: None
2024-10-14 14:41:30,839 - conversation_handler - INFO - Response generated: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
2024-10-14 14:41:30,839 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:41:30,839 - memory_manager - DEBUG - Current user_current_id state: {1: 1}
2024-10-14 14:41:30,839 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}}
2024-10-14 14:41:30,839 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:41:30,839 - memory_manager - DEBUG - Assigned message_id: 2
2024-10-14 14:41:30,839 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 2
2024-10-14 14:41:30,839 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=2, is_user_message=False, message=I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
2024-10-14 14:41:30,839 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:41:30,849 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=2
2024-10-14 14:41:30,849 - memory_manager - DEBUG - Final user_current_id state: {1: 2}
2024-10-14 14:41:30,849 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}
2024-10-14 14:41:30,849 - memory_manager - DEBUG - Total messages for user 1: 2
2024-10-14 14:41:30,849 - conversation_handler - DEBUG - Added AI response with ID: 2
2024-10-14 14:41:30,849 - root - INFO - Response generated successfully
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_header_value with data[81:103]
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_part_data with data[107:214]
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_header_field with data[276:295]
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_header_value with data[297:323]
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_part_data with data[327:334]
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:30,861 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:41:30,862 - root - INFO - Received TTS request for text: 'I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?' in language: English, speaker ID: None
2024-10-14 14:41:30,862 - root - DEBUG - Generating audio using MeloTTSGenerator
2024-10-14 14:41:30,862 - meloTTS - INFO - Generating audio for text: 'I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?', speaker_id: 1, language: EN
2024-10-14 14:41:30,864 - httpcore.connection - DEBUG - close.started
2024-10-14 14:41:30,864 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:41:31,056 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /bert-base-uncased/resolve/main/tokenizer_config.json HTTP/11" 200 0
2024-10-14 14:41:31,212 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /dccuchile/bert-base-spanish-wwm-uncased/resolve/main/tokenizer_config.json HTTP/11" 200 0
2024-10-14 14:41:31,357 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /dbmdz/bert-base-french-europeana-cased/resolve/main/tokenizer_config.json HTTP/11" 200 0
2024-10-14 14:41:31,515 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /bert-base-uncased/resolve/main/config.json HTTP/11" 200 0
2024-10-14 14:41:32,227 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /bert-base-uncased/resolve/main/generation_config.json HTTP/11" 404 0
2024-10-14 14:41:36,482 - meloTTS - INFO - Successfully generated audio. Shape: (268957,)
2024-10-14 14:41:36,482 - root - DEBUG - Audio generated successfully, preparing response
2024-10-14 14:41:36,484 - root - INFO - Returning audio as StreamingResponse
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_field with data[61:80]
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_value with data[82:131]
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_field with data[133:145]
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_value with data[147:169]
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_part_data with data[173:64974]
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_part_data with data[0:26356]
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_field with data[26419:26438]
2024-10-14 14:41:48,636 - multipart.multipart - DEBUG - Calling on_header_value with data[26440:26466]
2024-10-14 14:41:48,637 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:48,637 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:48,637 - multipart.multipart - DEBUG - Calling on_part_data with data[26470:26477]
2024-10-14 14:41:48,637 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:48,637 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:41:48,637 - root - INFO - Received transcription request for file: recording.webm
2024-10-14 14:41:48,637 - root - INFO - File read successfully, starting transcription
2024-10-14 14:41:48,637 - conversation_handler - INFO - Starting audio transcription. Language: English, Format: webm
2024-10-14 14:41:51,006 - conversation_handler - DEBUG - Whisper model loaded
2024-10-14 14:41:51,062 - pydub.converter - DEBUG - subprocess.call(['ffmpeg', '-y', '-f', 'webm', '-read_ahead_limit', '-1', '-i', 'cache:pipe:0', '-acodec', 'pcm_s32le', '-vn', '-f', 'wav', '-'])
2024-10-14 14:41:51,103 - conversation_handler - DEBUG - Audio content converted to AudioSegment
2024-10-14 14:41:51,106 - conversation_handler - DEBUG - Audio resampled to 16000 Hz
2024-10-14 14:41:51,106 - conversation_handler - DEBUG - Audio converted to mono
2024-10-14 14:41:51,106 - conversation_handler - DEBUG - Audio converted to numpy array
2024-10-14 14:41:51,106 - conversation_handler - DEBUG - Audio normalized
2024-10-14 14:41:51,106 - conversation_handler - INFO - Starting Whisper transcription
2024-10-14 14:41:51,404 - conversation_handler - INFO - Transcription completed. Result:  I'm lost to hang out with friends and studying.
2024-10-14 14:41:51,406 - root - INFO - Transcription completed successfully
2024-10-14 14:41:51,419 - root - INFO - Received generate request for user 1, conversation 1
2024-10-14 14:41:51,419 - conversation_handler - INFO - Generating response for user 1, conversation 1
2024-10-14 14:41:51,419 - conversation_handler - DEBUG - New message:  I'm lost to hang out with friends and studying.
2024-10-14 14:41:51,420 - conversation_handler - DEBUG - Language: English
2024-10-14 14:41:51,420 - conversation_handler - DEBUG - Using MemoryManager instance ID: 140206534764256
2024-10-14 14:41:51,420 - conversation_handler - DEBUG - System prompt: You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.
    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION
    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT
    If the user asks you a question, you can answer it and ask them a question back.
    If the user asks to change language, you will simply respond with the language they want to change to.
    Example prompt: 
    USER : Hello, how are you?
    AI : Hello! I am well, how are you?
    USER : I'm feeling good, I have been busy with school.
    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?
    
    Example prompt:
    User: I am so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we switch to Japanese?
    Example of expected output: Japanese
    
    Example prompt:
    User:   I'm lonely.
    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?
    User: Yeah, yeah, I have some friends I could speak to.
    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?
    User: Could we switch to speaking in Japanese?
    AI: Japanese
    Example of expected output: Japanese
                
    Example prompt:
    User: I'm so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we speak Japanese instead?
    Example of expected output: Japanese      

    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     
                
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Retrieving conversation window for user 1, conversation 1
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Retrieved 2 messages for user 1
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Last summarized ID for user 1: -1
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Retrieved all messages: [{'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}]
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Retrieved 2 unsummarized messages for user 1, conversation 1
2024-10-14 14:41:51,420 - conversation_handler - DEBUG - Retrieved 2 messages from the conversation window
2024-10-14 14:41:51,420 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Current user_current_id state: {1: 2}
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}}
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Assigned message_id: 3
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 3
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=3, is_user_message=True, message= I'm lost to hang out with friends and studying.
2024-10-14 14:41:51,420 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:41:51,431 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=3
2024-10-14 14:41:51,432 - memory_manager - DEBUG - Final user_current_id state: {1: 3}
2024-10-14 14:41:51,432 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}
2024-10-14 14:41:51,432 - memory_manager - DEBUG - Total messages for user 1: 3
2024-10-14 14:41:51,432 - conversation_handler - DEBUG - Added new user message with ID: 3
2024-10-14 14:41:51,432 - memory_manager - DEBUG - Managing conversation window for user 1, conversation 1
2024-10-14 14:41:51,432 - memory_manager - DEBUG - Retrieved 3 user_messages for user 1
2024-10-14 14:41:51,432 - memory_manager - DEBUG - Retrieved 3 conversation_messages for user 1, conversation 1
2024-10-14 14:41:51,432 - memory_manager - DEBUG - No last summarized ID found for user 1
2024-10-14 14:41:51,432 - memory_manager - DEBUG - Retrieved 3 unsummarized messages
2024-10-14 14:41:51,432 - conversation_handler - DEBUG - Conversation window managed
2024-10-14 14:41:51,432 - conversation_handler - DEBUG - Context prepared for response generation: User:  So, how are you?
AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
2024-10-14 14:41:51,432 - conversation_handler - DEBUG - First few context messages: ['User:  So, how are you?', "AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?"]
2024-10-14 14:41:51,432 - conversation_handler - INFO - Calling LLama for response generation
2024-10-14 14:41:51,432 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-10-14 14:41:51,432 - httpx - DEBUG - load_verify_locations cafile='/home/miranda/melotest/MeloTTS/venv/lib/python3.10/site-packages/certifi/cacert.pem'
2024-10-14 14:41:51,453 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.\n    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION\n    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT\n    If the user asks you a question, you can answer it and ask them a question back.\n    If the user asks to change language, you will simply respond with the language they want to change to.\n    Example prompt: \n    USER : Hello, how are you?\n    AI : Hello! I am well, how are you?\n    USER : I'm feeling good, I have been busy with school.\n    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?\n    \n    Example prompt:\n    User: I am so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we switch to Japanese?\n    Example of expected output: Japanese\n    \n    Example prompt:\n    User:   I'm lonely.\n    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?\n    User: Yeah, yeah, I have some friends I could speak to.\n    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?\n    User: Could we switch to speaking in Japanese?\n    AI: Japanese\n    Example of expected output: Japanese\n                \n    Example prompt:\n    User: I'm so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we speak Japanese instead?\n    Example of expected output: Japanese      \n\n    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     \n                "}, {'role': 'user', 'content': "Context:\nUser:  So, how are you?\nAI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?\nUser:  I'm lost to hang out with friends and studying.\nAI:"}], 'model': 'llama3.2'}}
2024-10-14 14:41:51,454 - openai._base_client - DEBUG - Sending HTTP Request: POST http://localhost:11434/v1/chat/completions
2024-10-14 14:41:51,454 - httpcore.connection - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2024-10-14 14:41:51,454 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f83c10a9de0>
2024-10-14 14:41:51,454 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-10-14 14:41:51,454 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-10-14 14:41:51,455 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-10-14 14:41:51,455 - httpcore.http11 - DEBUG - send_request_body.complete
2024-10-14 14:41:51,455 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-10-14 14:41:52,156 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json'), (b'Date', b'Mon, 14 Oct 2024 12:41:52 GMT'), (b'Content-Length', b'474')])
2024-10-14 14:41:52,157 - httpx - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2024-10-14 14:41:52,157 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-10-14 14:41:52,157 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-10-14 14:41:52,157 - httpcore.http11 - DEBUG - response_closed.started
2024-10-14 14:41:52,157 - httpcore.http11 - DEBUG - response_closed.complete
2024-10-14 14:41:52,157 - openai._base_client - DEBUG - HTTP Response: POST http://localhost:11434/v1/chat/completions "200 OK" Headers({'content-type': 'application/json', 'date': 'Mon, 14 Oct 2024 12:41:52 GMT', 'content-length': '474'})
2024-10-14 14:41:52,157 - openai._base_client - DEBUG - request_id: None
2024-10-14 14:41:52,157 - conversation_handler - INFO - Response generated: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?
2024-10-14 14:41:52,157 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:41:52,157 - memory_manager - DEBUG - Current user_current_id state: {1: 3}
2024-10-14 14:41:52,157 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}}
2024-10-14 14:41:52,158 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:41:52,158 - memory_manager - DEBUG - Assigned message_id: 4
2024-10-14 14:41:52,158 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 4
2024-10-14 14:41:52,158 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=4, is_user_message=False, message=It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?
2024-10-14 14:41:52,158 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:41:52,170 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=4
2024-10-14 14:41:52,170 - memory_manager - DEBUG - Final user_current_id state: {1: 4}
2024-10-14 14:41:52,170 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}
2024-10-14 14:41:52,170 - memory_manager - DEBUG - Total messages for user 1: 4
2024-10-14 14:41:52,170 - conversation_handler - DEBUG - Added AI response with ID: 4
2024-10-14 14:41:52,170 - root - INFO - Response generated successfully
2024-10-14 14:41:52,179 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:52,179 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:41:52,179 - multipart.multipart - DEBUG - Calling on_header_value with data[81:103]
2024-10-14 14:41:52,179 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_part_data with data[107:296]
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_header_field with data[358:377]
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_header_value with data[379:405]
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_part_data with data[409:416]
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:41:52,180 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:41:52,180 - root - INFO - Received TTS request for text: 'It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?' in language: English, speaker ID: None
2024-10-14 14:41:52,180 - root - DEBUG - Generating audio using MeloTTSGenerator
2024-10-14 14:41:52,180 - meloTTS - INFO - Generating audio for text: 'It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?', speaker_id: 1, language: EN
2024-10-14 14:42:01,743 - meloTTS - INFO - Successfully generated audio. Shape: (438941,)
2024-10-14 14:42:01,743 - root - DEBUG - Audio generated successfully, preparing response
2024-10-14 14:42:01,745 - root - INFO - Returning audio as StreamingResponse
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_header_field with data[61:80]
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_header_value with data[82:131]
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_header_field with data[133:145]
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_header_value with data[147:169]
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_part_data with data[173:64974]
2024-10-14 14:42:21,174 - multipart.multipart - DEBUG - Calling on_part_data with data[0:28582]
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_header_field with data[28645:28664]
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_header_value with data[28666:28692]
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_part_data with data[28696:28703]
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:21,175 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:42:21,175 - root - INFO - Received transcription request for file: recording.webm
2024-10-14 14:42:21,175 - root - INFO - File read successfully, starting transcription
2024-10-14 14:42:21,175 - conversation_handler - INFO - Starting audio transcription. Language: English, Format: webm
2024-10-14 14:42:21,570 - httpcore.connection - DEBUG - close.started
2024-10-14 14:42:21,570 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:42:23,593 - conversation_handler - DEBUG - Whisper model loaded
2024-10-14 14:42:23,663 - pydub.converter - DEBUG - subprocess.call(['ffmpeg', '-y', '-f', 'webm', '-read_ahead_limit', '-1', '-i', 'cache:pipe:0', '-acodec', 'pcm_s32le', '-vn', '-f', 'wav', '-'])
2024-10-14 14:42:23,702 - conversation_handler - DEBUG - Audio content converted to AudioSegment
2024-10-14 14:42:23,704 - conversation_handler - DEBUG - Audio resampled to 16000 Hz
2024-10-14 14:42:23,704 - conversation_handler - DEBUG - Audio converted to mono
2024-10-14 14:42:23,704 - conversation_handler - DEBUG - Audio converted to numpy array
2024-10-14 14:42:23,704 - conversation_handler - DEBUG - Audio normalized
2024-10-14 14:42:23,704 - conversation_handler - INFO - Starting Whisper transcription
2024-10-14 14:42:24,139 - conversation_handler - INFO - Transcription completed. Result:  Yes, I've been... it's been going well. I've managed pretty well.
2024-10-14 14:42:24,141 - root - INFO - Transcription completed successfully
2024-10-14 14:42:24,161 - root - INFO - Received generate request for user 1, conversation 1
2024-10-14 14:42:24,161 - conversation_handler - INFO - Generating response for user 1, conversation 1
2024-10-14 14:42:24,161 - conversation_handler - DEBUG - New message:  Yes, I've been... it's been going well. I've managed pretty well.
2024-10-14 14:42:24,161 - conversation_handler - DEBUG - Language: English
2024-10-14 14:42:24,161 - conversation_handler - DEBUG - Using MemoryManager instance ID: 140206534764256
2024-10-14 14:42:24,161 - conversation_handler - DEBUG - System prompt: You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.
    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION
    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT
    If the user asks you a question, you can answer it and ask them a question back.
    If the user asks to change language, you will simply respond with the language they want to change to.
    Example prompt: 
    USER : Hello, how are you?
    AI : Hello! I am well, how are you?
    USER : I'm feeling good, I have been busy with school.
    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?
    
    Example prompt:
    User: I am so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we switch to Japanese?
    Example of expected output: Japanese
    
    Example prompt:
    User:   I'm lonely.
    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?
    User: Yeah, yeah, I have some friends I could speak to.
    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?
    User: Could we switch to speaking in Japanese?
    AI: Japanese
    Example of expected output: Japanese
                
    Example prompt:
    User: I'm so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we speak Japanese instead?
    Example of expected output: Japanese      

    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     
                
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Retrieving conversation window for user 1, conversation 1
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Retrieved 4 messages for user 1
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Last summarized ID for user 1: -1
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Retrieved all messages: [{'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}]
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Retrieved 4 unsummarized messages for user 1, conversation 1
2024-10-14 14:42:24,161 - conversation_handler - DEBUG - Retrieved 4 messages from the conversation window
2024-10-14 14:42:24,161 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Current user_current_id state: {1: 4}
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}}
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Assigned message_id: 5
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 5
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=5, is_user_message=True, message= Yes, I've been... it's been going well. I've managed pretty well.
2024-10-14 14:42:24,161 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:42:24,168 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=5
2024-10-14 14:42:24,168 - memory_manager - DEBUG - Final user_current_id state: {1: 5}
2024-10-14 14:42:24,168 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}
2024-10-14 14:42:24,168 - memory_manager - DEBUG - Total messages for user 1: 5
2024-10-14 14:42:24,168 - conversation_handler - DEBUG - Added new user message with ID: 5
2024-10-14 14:42:24,169 - memory_manager - DEBUG - Managing conversation window for user 1, conversation 1
2024-10-14 14:42:24,169 - memory_manager - DEBUG - Retrieved 5 user_messages for user 1
2024-10-14 14:42:24,169 - memory_manager - DEBUG - Retrieved 5 conversation_messages for user 1, conversation 1
2024-10-14 14:42:24,169 - memory_manager - DEBUG - No last summarized ID found for user 1
2024-10-14 14:42:24,169 - memory_manager - DEBUG - Retrieved 5 unsummarized messages
2024-10-14 14:42:24,169 - conversation_handler - DEBUG - Conversation window managed
2024-10-14 14:42:24,169 - conversation_handler - DEBUG - Context prepared for response generation: User:  So, how are you?
AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
User:  I'm lost to hang out with friends and studying.
AI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?
2024-10-14 14:42:24,169 - conversation_handler - DEBUG - First few context messages: ['User:  So, how are you?', "AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", "User:  I'm lost to hang out with friends and studying."]
2024-10-14 14:42:24,169 - conversation_handler - INFO - Calling LLama for response generation
2024-10-14 14:42:24,169 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-10-14 14:42:24,170 - httpx - DEBUG - load_verify_locations cafile='/home/miranda/melotest/MeloTTS/venv/lib/python3.10/site-packages/certifi/cacert.pem'
2024-10-14 14:42:24,194 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.\n    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION\n    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT\n    If the user asks you a question, you can answer it and ask them a question back.\n    If the user asks to change language, you will simply respond with the language they want to change to.\n    Example prompt: \n    USER : Hello, how are you?\n    AI : Hello! I am well, how are you?\n    USER : I'm feeling good, I have been busy with school.\n    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?\n    \n    Example prompt:\n    User: I am so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we switch to Japanese?\n    Example of expected output: Japanese\n    \n    Example prompt:\n    User:   I'm lonely.\n    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?\n    User: Yeah, yeah, I have some friends I could speak to.\n    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?\n    User: Could we switch to speaking in Japanese?\n    AI: Japanese\n    Example of expected output: Japanese\n                \n    Example prompt:\n    User: I'm so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we speak Japanese instead?\n    Example of expected output: Japanese      \n\n    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     \n                "}, {'role': 'user', 'content': "Context:\nUser:  So, how are you?\nAI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?\nUser:  I'm lost to hang out with friends and studying.\nAI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?\nUser:  Yes, I've been... it's been going well. I've managed pretty well.\nAI:"}], 'model': 'llama3.2'}}
2024-10-14 14:42:24,194 - openai._base_client - DEBUG - Sending HTTP Request: POST http://localhost:11434/v1/chat/completions
2024-10-14 14:42:24,194 - httpcore.connection - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2024-10-14 14:42:24,195 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f83c10aa230>
2024-10-14 14:42:24,195 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-10-14 14:42:24,195 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-10-14 14:42:24,195 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-10-14 14:42:24,195 - httpcore.http11 - DEBUG - send_request_body.complete
2024-10-14 14:42:24,195 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-10-14 14:42:24,928 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json'), (b'Date', b'Mon, 14 Oct 2024 12:42:24 GMT'), (b'Content-Length', b'504')])
2024-10-14 14:42:24,928 - httpx - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2024-10-14 14:42:24,928 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-10-14 14:42:24,929 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-10-14 14:42:24,929 - httpcore.http11 - DEBUG - response_closed.started
2024-10-14 14:42:24,929 - httpcore.http11 - DEBUG - response_closed.complete
2024-10-14 14:42:24,929 - openai._base_client - DEBUG - HTTP Response: POST http://localhost:11434/v1/chat/completions "200 OK" Headers({'content-type': 'application/json', 'date': 'Mon, 14 Oct 2024 12:42:24 GMT', 'content-length': '504'})
2024-10-14 14:42:24,929 - openai._base_client - DEBUG - request_id: None
2024-10-14 14:42:24,930 - conversation_handler - INFO - Response generated: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?
2024-10-14 14:42:24,930 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:42:24,930 - memory_manager - DEBUG - Current user_current_id state: {1: 5}
2024-10-14 14:42:24,930 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}}
2024-10-14 14:42:24,930 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:42:24,930 - memory_manager - DEBUG - Assigned message_id: 6
2024-10-14 14:42:24,930 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 6
2024-10-14 14:42:24,930 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=6, is_user_message=False, message=That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?
2024-10-14 14:42:24,930 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:42:24,939 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=6
2024-10-14 14:42:24,939 - memory_manager - DEBUG - Final user_current_id state: {1: 6}
2024-10-14 14:42:24,939 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}
2024-10-14 14:42:24,939 - memory_manager - DEBUG - Total messages for user 1: 6
2024-10-14 14:42:24,939 - conversation_handler - DEBUG - Added AI response with ID: 6
2024-10-14 14:42:24,939 - root - INFO - Response generated successfully
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_header_value with data[81:103]
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_part_data with data[107:327]
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_header_field with data[389:408]
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_header_value with data[410:436]
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_part_data with data[440:447]
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:24,949 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:42:24,950 - root - INFO - Received TTS request for text: 'That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?' in language: English, speaker ID: None
2024-10-14 14:42:24,950 - root - DEBUG - Generating audio using MeloTTSGenerator
2024-10-14 14:42:24,950 - meloTTS - INFO - Generating audio for text: 'That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?', speaker_id: 1, language: EN
2024-10-14 14:42:36,090 - meloTTS - INFO - Successfully generated audio. Shape: (490653,)
2024-10-14 14:42:36,090 - root - DEBUG - Audio generated successfully, preparing response
2024-10-14 14:42:36,092 - root - INFO - Returning audio as StreamingResponse
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_header_value with data[81:130]
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_header_field with data[132:144]
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_header_value with data[146:168]
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_part_data with data[172:32234]
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_part_data with data[0:16449]
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:51,295 - multipart.multipart - DEBUG - Calling on_header_field with data[16511:16530]
2024-10-14 14:42:51,296 - multipart.multipart - DEBUG - Calling on_header_value with data[16532:16558]
2024-10-14 14:42:51,296 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:51,296 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:51,296 - multipart.multipart - DEBUG - Calling on_part_data with data[16562:16569]
2024-10-14 14:42:51,296 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:51,296 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:42:51,296 - root - INFO - Received transcription request for file: recording.webm
2024-10-14 14:42:51,296 - root - INFO - File read successfully, starting transcription
2024-10-14 14:42:51,296 - conversation_handler - INFO - Starting audio transcription. Language: English, Format: webm
2024-10-14 14:42:51,713 - httpcore.connection - DEBUG - close.started
2024-10-14 14:42:51,714 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:42:53,598 - conversation_handler - DEBUG - Whisper model loaded
2024-10-14 14:42:53,654 - pydub.converter - DEBUG - subprocess.call(['ffmpeg', '-y', '-f', 'webm', '-read_ahead_limit', '-1', '-i', 'cache:pipe:0', '-acodec', 'pcm_s32le', '-vn', '-f', 'wav', '-'])
2024-10-14 14:42:53,688 - conversation_handler - DEBUG - Audio content converted to AudioSegment
2024-10-14 14:42:53,690 - conversation_handler - DEBUG - Audio resampled to 16000 Hz
2024-10-14 14:42:53,690 - conversation_handler - DEBUG - Audio converted to mono
2024-10-14 14:42:53,690 - conversation_handler - DEBUG - Audio converted to numpy array
2024-10-14 14:42:53,690 - conversation_handler - DEBUG - Audio normalized
2024-10-14 14:42:53,690 - conversation_handler - INFO - Starting Whisper transcription
2024-10-14 14:42:53,882 - conversation_handler - INFO - Transcription completed. Result:  Could we speak in Japanese?
2024-10-14 14:42:53,883 - root - INFO - Transcription completed successfully
2024-10-14 14:42:53,903 - root - INFO - Received generate request for user 1, conversation 1
2024-10-14 14:42:53,903 - conversation_handler - INFO - Generating response for user 1, conversation 1
2024-10-14 14:42:53,903 - conversation_handler - DEBUG - New message:  Could we speak in Japanese?
2024-10-14 14:42:53,903 - conversation_handler - DEBUG - Language: English
2024-10-14 14:42:53,903 - conversation_handler - DEBUG - Using MemoryManager instance ID: 140206534764256
2024-10-14 14:42:53,903 - conversation_handler - DEBUG - System prompt: You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.
    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION
    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT
    If the user asks you a question, you can answer it and ask them a question back.
    If the user asks to change language, you will simply respond with the language they want to change to.
    Example prompt: 
    USER : Hello, how are you?
    AI : Hello! I am well, how are you?
    USER : I'm feeling good, I have been busy with school.
    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?
    
    Example prompt:
    User: I am so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we switch to Japanese?
    Example of expected output: Japanese
    
    Example prompt:
    User:   I'm lonely.
    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?
    User: Yeah, yeah, I have some friends I could speak to.
    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?
    User: Could we switch to speaking in Japanese?
    AI: Japanese
    Example of expected output: Japanese
                
    Example prompt:
    User: I'm so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we speak Japanese instead?
    Example of expected output: Japanese      

    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     
                
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Retrieving conversation window for user 1, conversation 1
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Retrieved 6 messages for user 1
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Last summarized ID for user 1: -1
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Retrieved all messages: [{'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}]
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Retrieved 6 unsummarized messages for user 1, conversation 1
2024-10-14 14:42:53,903 - conversation_handler - DEBUG - Retrieved 6 messages from the conversation window
2024-10-14 14:42:53,903 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Current user_current_id state: {1: 6}
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}}
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Assigned message_id: 7
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 7
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=7, is_user_message=True, message= Could we speak in Japanese?
2024-10-14 14:42:53,903 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=7
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Final user_current_id state: {1: 7}
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Total messages for user 1: 7
2024-10-14 14:42:53,916 - conversation_handler - DEBUG - Added new user message with ID: 7
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Managing conversation window for user 1, conversation 1
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Retrieved 7 user_messages for user 1
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Retrieved 7 conversation_messages for user 1, conversation 1
2024-10-14 14:42:53,916 - memory_manager - DEBUG - No last summarized ID found for user 1
2024-10-14 14:42:53,916 - memory_manager - DEBUG - Retrieved 7 unsummarized messages
2024-10-14 14:42:53,916 - conversation_handler - DEBUG - Conversation window managed
2024-10-14 14:42:53,916 - conversation_handler - DEBUG - Context prepared for response generation: User:  So, how are you?
AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
User:  I'm lost to hang out with friends and studying.
AI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?
User:  Yes, I've been... it's been going well. I've managed pretty well.
AI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?
2024-10-14 14:42:53,916 - conversation_handler - DEBUG - First few context messages: ['User:  So, how are you?', "AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", "User:  I'm lost to hang out with friends and studying."]
2024-10-14 14:42:53,916 - conversation_handler - INFO - Calling LLama for response generation
2024-10-14 14:42:53,916 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-10-14 14:42:53,917 - httpx - DEBUG - load_verify_locations cafile='/home/miranda/melotest/MeloTTS/venv/lib/python3.10/site-packages/certifi/cacert.pem'
2024-10-14 14:42:53,943 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.\n    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION\n    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT\n    If the user asks you a question, you can answer it and ask them a question back.\n    If the user asks to change language, you will simply respond with the language they want to change to.\n    Example prompt: \n    USER : Hello, how are you?\n    AI : Hello! I am well, how are you?\n    USER : I'm feeling good, I have been busy with school.\n    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?\n    \n    Example prompt:\n    User: I am so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we switch to Japanese?\n    Example of expected output: Japanese\n    \n    Example prompt:\n    User:   I'm lonely.\n    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?\n    User: Yeah, yeah, I have some friends I could speak to.\n    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?\n    User: Could we switch to speaking in Japanese?\n    AI: Japanese\n    Example of expected output: Japanese\n                \n    Example prompt:\n    User: I'm so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we speak Japanese instead?\n    Example of expected output: Japanese      \n\n    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     \n                "}, {'role': 'user', 'content': "Context:\nUser:  So, how are you?\nAI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?\nUser:  I'm lost to hang out with friends and studying.\nAI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?\nUser:  Yes, I've been... it's been going well. I've managed pretty well.\nAI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?\nUser:  Could we speak in Japanese?\nAI:"}], 'model': 'llama3.2'}}
2024-10-14 14:42:53,944 - openai._base_client - DEBUG - Sending HTTP Request: POST http://localhost:11434/v1/chat/completions
2024-10-14 14:42:53,944 - httpcore.connection - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2024-10-14 14:42:53,944 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f8392d571f0>
2024-10-14 14:42:53,944 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-10-14 14:42:53,944 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-10-14 14:42:53,945 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-10-14 14:42:53,945 - httpcore.http11 - DEBUG - send_request_body.complete
2024-10-14 14:42:53,945 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-10-14 14:42:54,228 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json'), (b'Date', b'Mon, 14 Oct 2024 12:42:54 GMT'), (b'Content-Length', b'296')])
2024-10-14 14:42:54,228 - httpx - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2024-10-14 14:42:54,228 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-10-14 14:42:54,228 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-10-14 14:42:54,228 - httpcore.http11 - DEBUG - response_closed.started
2024-10-14 14:42:54,228 - httpcore.http11 - DEBUG - response_closed.complete
2024-10-14 14:42:54,228 - openai._base_client - DEBUG - HTTP Response: POST http://localhost:11434/v1/chat/completions "200 OK" Headers({'content-type': 'application/json', 'date': 'Mon, 14 Oct 2024 12:42:54 GMT', 'content-length': '296'})
2024-10-14 14:42:54,228 - openai._base_client - DEBUG - request_id: None
2024-10-14 14:42:54,229 - conversation_handler - INFO - Response generated: Nihongo desu.
2024-10-14 14:42:54,229 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:42:54,229 - memory_manager - DEBUG - Current user_current_id state: {1: 7}
2024-10-14 14:42:54,229 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}}
2024-10-14 14:42:54,229 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:42:54,229 - memory_manager - DEBUG - Assigned message_id: 8
2024-10-14 14:42:54,229 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 8
2024-10-14 14:42:54,229 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=8, is_user_message=False, message=Nihongo desu.
2024-10-14 14:42:54,229 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:42:54,235 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=8
2024-10-14 14:42:54,235 - memory_manager - DEBUG - Final user_current_id state: {1: 8}
2024-10-14 14:42:54,235 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}
2024-10-14 14:42:54,235 - memory_manager - DEBUG - Total messages for user 1: 8
2024-10-14 14:42:54,235 - conversation_handler - DEBUG - Added AI response with ID: 8
2024-10-14 14:42:54,235 - root - INFO - Response generated successfully
2024-10-14 14:42:54,245 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:54,245 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:42:54,245 - multipart.multipart - DEBUG - Calling on_header_value with data[81:103]
2024-10-14 14:42:54,245 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:54,245 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_part_data with data[107:120]
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_header_field with data[182:201]
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_header_value with data[203:229]
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_part_data with data[233:240]
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:42:54,246 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:42:54,246 - root - INFO - Received TTS request for text: 'Nihongo desu.' in language: English, speaker ID: None
2024-10-14 14:42:54,246 - root - DEBUG - Generating audio using MeloTTSGenerator
2024-10-14 14:42:54,246 - meloTTS - INFO - Generating audio for text: 'Nihongo desu.', speaker_id: 1, language: EN
2024-10-14 14:42:55,849 - meloTTS - INFO - Successfully generated audio. Shape: (64157,)
2024-10-14 14:42:55,849 - root - DEBUG - Audio generated successfully, preparing response
2024-10-14 14:42:55,849 - root - INFO - Returning audio as StreamingResponse
2024-10-14 14:43:08,094 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_value with data[81:130]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_field with data[132:144]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_value with data[146:168]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_part_data with data[172:32234]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_part_data with data[0:29325]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_field with data[29387:29406]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_value with data[29408:29434]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_part_data with data[29438:29445]
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:08,095 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:43:08,095 - root - INFO - Received transcription request for file: recording.webm
2024-10-14 14:43:08,095 - root - INFO - File read successfully, starting transcription
2024-10-14 14:43:08,095 - conversation_handler - INFO - Starting audio transcription. Language: English, Format: webm
2024-10-14 14:43:08,479 - httpcore.connection - DEBUG - close.started
2024-10-14 14:43:08,480 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:43:10,469 - conversation_handler - DEBUG - Whisper model loaded
2024-10-14 14:43:10,533 - pydub.converter - DEBUG - subprocess.call(['ffmpeg', '-y', '-f', 'webm', '-read_ahead_limit', '-1', '-i', 'cache:pipe:0', '-acodec', 'pcm_s32le', '-vn', '-f', 'wav', '-'])
2024-10-14 14:43:10,566 - conversation_handler - DEBUG - Audio content converted to AudioSegment
2024-10-14 14:43:10,568 - conversation_handler - DEBUG - Audio resampled to 16000 Hz
2024-10-14 14:43:10,568 - conversation_handler - DEBUG - Audio converted to mono
2024-10-14 14:43:10,568 - conversation_handler - DEBUG - Audio converted to numpy array
2024-10-14 14:43:10,568 - conversation_handler - DEBUG - Audio normalized
2024-10-14 14:43:10,568 - conversation_handler - INFO - Starting Whisper transcription
2024-10-14 14:43:10,741 - conversation_handler - INFO - Transcription completed. Result:  No, I mean like switch to Japanese.
2024-10-14 14:43:10,743 - root - INFO - Transcription completed successfully
2024-10-14 14:43:10,764 - root - INFO - Received generate request for user 1, conversation 1
2024-10-14 14:43:10,764 - conversation_handler - INFO - Generating response for user 1, conversation 1
2024-10-14 14:43:10,764 - conversation_handler - DEBUG - New message:  No, I mean like switch to Japanese.
2024-10-14 14:43:10,764 - conversation_handler - DEBUG - Language: English
2024-10-14 14:43:10,764 - conversation_handler - DEBUG - Using MemoryManager instance ID: 140206534764256
2024-10-14 14:43:10,764 - conversation_handler - DEBUG - System prompt: You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.
    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION
    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT
    If the user asks you a question, you can answer it and ask them a question back.
    If the user asks to change language, you will simply respond with the language they want to change to.
    Example prompt: 
    USER : Hello, how are you?
    AI : Hello! I am well, how are you?
    USER : I'm feeling good, I have been busy with school.
    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?
    
    Example prompt:
    User: I am so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we switch to Japanese?
    Example of expected output: Japanese
    
    Example prompt:
    User:   I'm lonely.
    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?
    User: Yeah, yeah, I have some friends I could speak to.
    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?
    User: Could we switch to speaking in Japanese?
    AI: Japanese
    Example of expected output: Japanese
                
    Example prompt:
    User: I'm so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we speak Japanese instead?
    Example of expected output: Japanese      

    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     
                
2024-10-14 14:43:10,764 - memory_manager - DEBUG - Retrieving conversation window for user 1, conversation 1
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Retrieved 8 messages for user 1
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Last summarized ID for user 1: -1
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Retrieved all messages: [{'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}]
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Retrieved 8 unsummarized messages for user 1, conversation 1
2024-10-14 14:43:10,765 - conversation_handler - DEBUG - Retrieved 8 messages from the conversation window
2024-10-14 14:43:10,765 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Current user_current_id state: {1: 8}
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}}
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Assigned message_id: 9
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 9
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=9, is_user_message=True, message= No, I mean like switch to Japanese.
2024-10-14 14:43:10,765 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=9
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Final user_current_id state: {1: 9}
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Total messages for user 1: 9
2024-10-14 14:43:10,779 - conversation_handler - DEBUG - Added new user message with ID: 9
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Managing conversation window for user 1, conversation 1
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Retrieved 9 user_messages for user 1
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Retrieved 9 conversation_messages for user 1, conversation 1
2024-10-14 14:43:10,779 - memory_manager - DEBUG - No last summarized ID found for user 1
2024-10-14 14:43:10,779 - memory_manager - DEBUG - Retrieved 9 unsummarized messages
2024-10-14 14:43:10,779 - conversation_handler - DEBUG - Conversation window managed
2024-10-14 14:43:10,779 - conversation_handler - DEBUG - Context prepared for response generation: User:  So, how are you?
AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
User:  I'm lost to hang out with friends and studying.
AI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?
User:  Yes, I've been... it's been going well. I've managed pretty well.
AI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?
User:  Could we speak in Japanese?
AI: Nihongo desu.
2024-10-14 14:43:10,779 - conversation_handler - DEBUG - First few context messages: ['User:  So, how are you?', "AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", "User:  I'm lost to hang out with friends and studying."]
2024-10-14 14:43:10,779 - conversation_handler - INFO - Calling LLama for response generation
2024-10-14 14:43:10,780 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-10-14 14:43:10,780 - httpx - DEBUG - load_verify_locations cafile='/home/miranda/melotest/MeloTTS/venv/lib/python3.10/site-packages/certifi/cacert.pem'
2024-10-14 14:43:10,807 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.\n    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION\n    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT\n    If the user asks you a question, you can answer it and ask them a question back.\n    If the user asks to change language, you will simply respond with the language they want to change to.\n    Example prompt: \n    USER : Hello, how are you?\n    AI : Hello! I am well, how are you?\n    USER : I'm feeling good, I have been busy with school.\n    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?\n    \n    Example prompt:\n    User: I am so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we switch to Japanese?\n    Example of expected output: Japanese\n    \n    Example prompt:\n    User:   I'm lonely.\n    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?\n    User: Yeah, yeah, I have some friends I could speak to.\n    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?\n    User: Could we switch to speaking in Japanese?\n    AI: Japanese\n    Example of expected output: Japanese\n                \n    Example prompt:\n    User: I'm so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we speak Japanese instead?\n    Example of expected output: Japanese      \n\n    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     \n                "}, {'role': 'user', 'content': "Context:\nUser:  So, how are you?\nAI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?\nUser:  I'm lost to hang out with friends and studying.\nAI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?\nUser:  Yes, I've been... it's been going well. I've managed pretty well.\nAI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?\nUser:  Could we speak in Japanese?\nAI: Nihongo desu.\nUser:  No, I mean like switch to Japanese.\nAI:"}], 'model': 'llama3.2'}}
2024-10-14 14:43:10,807 - openai._base_client - DEBUG - Sending HTTP Request: POST http://localhost:11434/v1/chat/completions
2024-10-14 14:43:10,808 - httpcore.connection - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2024-10-14 14:43:10,808 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f8392d55210>
2024-10-14 14:43:10,808 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-10-14 14:43:10,808 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-10-14 14:43:10,808 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-10-14 14:43:10,808 - httpcore.http11 - DEBUG - send_request_body.complete
2024-10-14 14:43:10,808 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-10-14 14:43:11,233 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json'), (b'Date', b'Mon, 14 Oct 2024 12:43:11 GMT'), (b'Content-Length', b'348')])
2024-10-14 14:43:11,233 - httpx - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2024-10-14 14:43:11,233 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-10-14 14:43:11,234 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-10-14 14:43:11,234 - httpcore.http11 - DEBUG - response_closed.started
2024-10-14 14:43:11,234 - httpcore.http11 - DEBUG - response_closed.complete
2024-10-14 14:43:11,234 - openai._base_client - DEBUG - HTTP Response: POST http://localhost:11434/v1/chat/completions "200 OK" Headers({'content-type': 'application/json', 'date': 'Mon, 14 Oct 2024 12:43:11 GMT', 'content-length': '348'})
2024-10-14 14:43:11,234 - openai._base_client - DEBUG - request_id: None
2024-10-14 14:43:11,234 - conversation_handler - INFO - Response generated: Kore wa hontonichi no hanbun desu! (Today is our conversation.)
2024-10-14 14:43:11,234 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:43:11,234 - memory_manager - DEBUG - Current user_current_id state: {1: 9}
2024-10-14 14:43:11,234 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}}
2024-10-14 14:43:11,234 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:43:11,234 - memory_manager - DEBUG - Assigned message_id: 10
2024-10-14 14:43:11,234 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 10
2024-10-14 14:43:11,234 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=10, is_user_message=False, message=Kore wa hontonichi no hanbun desu! (Today is our conversation.)
2024-10-14 14:43:11,234 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:43:11,238 - httpcore.connection - DEBUG - close.started
2024-10-14 14:43:11,238 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:43:11,247 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=10
2024-10-14 14:43:11,247 - memory_manager - DEBUG - Final user_current_id state: {1: 10}
2024-10-14 14:43:11,248 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}
2024-10-14 14:43:11,248 - memory_manager - DEBUG - Total messages for user 1: 10
2024-10-14 14:43:11,248 - conversation_handler - DEBUG - Added AI response with ID: 10
2024-10-14 14:43:11,248 - root - INFO - Response generated successfully
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_header_field with data[61:80]
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_header_value with data[82:104]
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_part_data with data[108:171]
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_header_field with data[234:253]
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_header_value with data[255:281]
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_part_data with data[285:292]
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:11,259 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:43:11,259 - root - INFO - Received TTS request for text: 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)' in language: English, speaker ID: None
2024-10-14 14:43:11,260 - root - DEBUG - Generating audio using MeloTTSGenerator
2024-10-14 14:43:11,260 - meloTTS - INFO - Generating audio for text: 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', speaker_id: 1, language: EN
2024-10-14 14:43:15,138 - meloTTS - INFO - Successfully generated audio. Shape: (178333,)
2024-10-14 14:43:15,138 - root - DEBUG - Audio generated successfully, preparing response
2024-10-14 14:43:15,139 - root - INFO - Returning audio as StreamingResponse
2024-10-14 14:43:29,582 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_header_value with data[81:130]
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_header_field with data[132:144]
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_header_value with data[146:168]
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_part_data with data[172:64974]
2024-10-14 14:43:29,583 - multipart.multipart - DEBUG - Calling on_part_data with data[0:65482]
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_part_data with data[0:30179]
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_header_field with data[30241:30260]
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_header_value with data[30262:30288]
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_part_data with data[30292:30299]
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:29,584 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:43:29,584 - root - INFO - Received transcription request for file: recording.webm
2024-10-14 14:43:29,584 - root - INFO - File read successfully, starting transcription
2024-10-14 14:43:29,584 - conversation_handler - INFO - Starting audio transcription. Language: English, Format: webm
2024-10-14 14:43:32,017 - conversation_handler - DEBUG - Whisper model loaded
2024-10-14 14:43:32,077 - pydub.converter - DEBUG - subprocess.call(['ffmpeg', '-y', '-f', 'webm', '-read_ahead_limit', '-1', '-i', 'cache:pipe:0', '-acodec', 'pcm_s32le', '-vn', '-f', 'wav', '-'])
2024-10-14 14:43:32,126 - conversation_handler - DEBUG - Audio content converted to AudioSegment
2024-10-14 14:43:32,130 - conversation_handler - DEBUG - Audio resampled to 16000 Hz
2024-10-14 14:43:32,130 - conversation_handler - DEBUG - Audio converted to mono
2024-10-14 14:43:32,130 - conversation_handler - DEBUG - Audio converted to numpy array
2024-10-14 14:43:32,130 - conversation_handler - DEBUG - Audio normalized
2024-10-14 14:43:32,130 - conversation_handler - INFO - Starting Whisper transcription
2024-10-14 14:43:32,541 - conversation_handler - INFO - Transcription completed. Result:  No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?
2024-10-14 14:43:32,542 - root - INFO - Transcription completed successfully
2024-10-14 14:43:32,554 - root - INFO - Received generate request for user 1, conversation 1
2024-10-14 14:43:32,554 - conversation_handler - INFO - Generating response for user 1, conversation 1
2024-10-14 14:43:32,554 - conversation_handler - DEBUG - New message:  No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?
2024-10-14 14:43:32,554 - conversation_handler - DEBUG - Language: English
2024-10-14 14:43:32,554 - conversation_handler - DEBUG - Using MemoryManager instance ID: 140206534764256
2024-10-14 14:43:32,554 - conversation_handler - DEBUG - System prompt: You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.
    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION
    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT
    If the user asks you a question, you can answer it and ask them a question back.
    If the user asks to change language, you will simply respond with the language they want to change to.
    Example prompt: 
    USER : Hello, how are you?
    AI : Hello! I am well, how are you?
    USER : I'm feeling good, I have been busy with school.
    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?
    
    Example prompt:
    User: I am so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we switch to Japanese?
    Example of expected output: Japanese
    
    Example prompt:
    User:   I'm lonely.
    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?
    User: Yeah, yeah, I have some friends I could speak to.
    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?
    User: Could we switch to speaking in Japanese?
    AI: Japanese
    Example of expected output: Japanese
                
    Example prompt:
    User: I'm so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we speak Japanese instead?
    Example of expected output: Japanese      

    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     
                
2024-10-14 14:43:32,554 - memory_manager - DEBUG - Retrieving conversation window for user 1, conversation 1
2024-10-14 14:43:32,554 - memory_manager - DEBUG - Retrieved 10 messages for user 1
2024-10-14 14:43:32,554 - memory_manager - DEBUG - Last summarized ID for user 1: -1
2024-10-14 14:43:32,554 - memory_manager - DEBUG - Retrieved all messages: [{'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}]
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Retrieved 10 unsummarized messages for user 1, conversation 1
2024-10-14 14:43:32,555 - conversation_handler - DEBUG - Retrieved 10 messages from the conversation window
2024-10-14 14:43:32,555 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Current user_current_id state: {1: 10}
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}}
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Assigned message_id: 11
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 11
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=11, is_user_message=True, message= No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?
2024-10-14 14:43:32,555 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=11
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Final user_current_id state: {1: 11}
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 11: {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Total messages for user 1: 11
2024-10-14 14:43:32,568 - conversation_handler - DEBUG - Added new user message with ID: 11
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Managing conversation window for user 1, conversation 1
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Retrieved 11 user_messages for user 1
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Retrieved 11 conversation_messages for user 1, conversation 1
2024-10-14 14:43:32,568 - memory_manager - DEBUG - No last summarized ID found for user 1
2024-10-14 14:43:32,568 - memory_manager - DEBUG - Retrieved 11 unsummarized messages
2024-10-14 14:43:32,568 - conversation_handler - DEBUG - Conversation window managed
2024-10-14 14:43:32,568 - conversation_handler - DEBUG - Context prepared for response generation: User:  So, how are you?
AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
User:  I'm lost to hang out with friends and studying.
AI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?
User:  Yes, I've been... it's been going well. I've managed pretty well.
AI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?
User:  Could we speak in Japanese?
AI: Nihongo desu.
User:  No, I mean like switch to Japanese.
AI: Kore wa hontonichi no hanbun desu! (Today is our conversation.)
2024-10-14 14:43:32,568 - conversation_handler - DEBUG - First few context messages: ['User:  So, how are you?', "AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", "User:  I'm lost to hang out with friends and studying."]
2024-10-14 14:43:32,568 - conversation_handler - INFO - Calling LLama for response generation
2024-10-14 14:43:32,569 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-10-14 14:43:32,569 - httpx - DEBUG - load_verify_locations cafile='/home/miranda/melotest/MeloTTS/venv/lib/python3.10/site-packages/certifi/cacert.pem'
2024-10-14 14:43:32,593 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.\n    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION\n    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT\n    If the user asks you a question, you can answer it and ask them a question back.\n    If the user asks to change language, you will simply respond with the language they want to change to.\n    Example prompt: \n    USER : Hello, how are you?\n    AI : Hello! I am well, how are you?\n    USER : I'm feeling good, I have been busy with school.\n    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?\n    \n    Example prompt:\n    User: I am so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we switch to Japanese?\n    Example of expected output: Japanese\n    \n    Example prompt:\n    User:   I'm lonely.\n    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?\n    User: Yeah, yeah, I have some friends I could speak to.\n    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?\n    User: Could we switch to speaking in Japanese?\n    AI: Japanese\n    Example of expected output: Japanese\n                \n    Example prompt:\n    User: I'm so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we speak Japanese instead?\n    Example of expected output: Japanese      \n\n    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     \n                "}, {'role': 'user', 'content': "Context:\nUser:  So, how are you?\nAI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?\nUser:  I'm lost to hang out with friends and studying.\nAI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?\nUser:  Yes, I've been... it's been going well. I've managed pretty well.\nAI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?\nUser:  Could we speak in Japanese?\nAI: Nihongo desu.\nUser:  No, I mean like switch to Japanese.\nAI: Kore wa hontonichi no hanbun desu! (Today is our conversation.)\nUser:  No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?\nAI:"}], 'model': 'llama3.2'}}
2024-10-14 14:43:32,594 - openai._base_client - DEBUG - Sending HTTP Request: POST http://localhost:11434/v1/chat/completions
2024-10-14 14:43:32,594 - httpcore.connection - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2024-10-14 14:43:32,594 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f8392d55420>
2024-10-14 14:43:32,594 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-10-14 14:43:32,594 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-10-14 14:43:32,595 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-10-14 14:43:32,595 - httpcore.http11 - DEBUG - send_request_body.complete
2024-10-14 14:43:32,595 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-10-14 14:43:33,213 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json'), (b'Date', b'Mon, 14 Oct 2024 12:43:33 GMT'), (b'Content-Length', b'371')])
2024-10-14 14:43:33,213 - httpx - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2024-10-14 14:43:33,213 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-10-14 14:43:33,213 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-10-14 14:43:33,213 - httpcore.http11 - DEBUG - response_closed.started
2024-10-14 14:43:33,213 - httpcore.http11 - DEBUG - response_closed.complete
2024-10-14 14:43:33,213 - openai._base_client - DEBUG - HTTP Response: POST http://localhost:11434/v1/chat/completions "200 OK" Headers({'content-type': 'application/json', 'date': 'Mon, 14 Oct 2024 12:43:33 GMT', 'content-length': '371'})
2024-10-14 14:43:33,213 - openai._base_client - DEBUG - request_id: None
2024-10-14 14:43:33,214 - conversation_handler - INFO - Response generated: Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.
Kore ni tatemae arimasu ka?
2024-10-14 14:43:33,214 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:43:33,214 - memory_manager - DEBUG - Current user_current_id state: {1: 11}
2024-10-14 14:43:33,214 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 11: {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}}
2024-10-14 14:43:33,214 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:43:33,214 - memory_manager - DEBUG - Assigned message_id: 12
2024-10-14 14:43:33,214 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 12
2024-10-14 14:43:33,214 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=12, is_user_message=False, message=Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.
Kore ni tatemae arimasu ka?
2024-10-14 14:43:33,214 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:43:33,221 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=12
2024-10-14 14:43:33,221 - memory_manager - DEBUG - Final user_current_id state: {1: 12}
2024-10-14 14:43:33,221 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 11: {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 12: {'id': 12, 'content': 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.\nKore ni tatemae arimasu ka?', 'timestamp': '2024-10-14 14:43:33', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}
2024-10-14 14:43:33,221 - memory_manager - DEBUG - Total messages for user 1: 12
2024-10-14 14:43:33,221 - conversation_handler - DEBUG - Added AI response with ID: 12
2024-10-14 14:43:33,221 - root - INFO - Response generated successfully
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_header_field with data[60:79]
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_header_value with data[81:103]
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_part_data with data[107:193]
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_header_field with data[255:274]
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_header_value with data[276:302]
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_part_data with data[306:313]
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:33,232 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:43:33,232 - root - INFO - Received TTS request for text: 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.
Kore ni tatemae arimasu ka?' in language: English, speaker ID: None
2024-10-14 14:43:33,233 - root - DEBUG - Generating audio using MeloTTSGenerator
2024-10-14 14:43:33,233 - meloTTS - INFO - Generating audio for text: 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.
Kore ni tatemae arimasu ka?', speaker_id: 1, language: EN
2024-10-14 14:43:33,620 - httpcore.connection - DEBUG - close.started
2024-10-14 14:43:33,620 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:43:38,566 - meloTTS - INFO - Successfully generated audio. Shape: (269469,)
2024-10-14 14:43:38,566 - root - DEBUG - Audio generated successfully, preparing response
2024-10-14 14:43:38,567 - root - INFO - Returning audio as StreamingResponse
2024-10-14 14:43:50,589 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:50,589 - multipart.multipart - DEBUG - Calling on_header_field with data[61:80]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_value with data[82:131]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_field with data[133:145]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_value with data[147:169]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_part_data with data[173:64974]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_part_data with data[0:3261]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_field with data[3324:3343]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_value with data[3345:3371]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_part_data with data[3375:3382]
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:50,590 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:43:50,590 - root - INFO - Received transcription request for file: recording.webm
2024-10-14 14:43:50,590 - root - INFO - File read successfully, starting transcription
2024-10-14 14:43:50,590 - conversation_handler - INFO - Starting audio transcription. Language: English, Format: webm
2024-10-14 14:43:52,952 - conversation_handler - DEBUG - Whisper model loaded
2024-10-14 14:43:53,018 - pydub.converter - DEBUG - subprocess.call(['ffmpeg', '-y', '-f', 'webm', '-read_ahead_limit', '-1', '-i', 'cache:pipe:0', '-acodec', 'pcm_s32le', '-vn', '-f', 'wav', '-'])
2024-10-14 14:43:53,054 - conversation_handler - DEBUG - Audio content converted to AudioSegment
2024-10-14 14:43:53,056 - conversation_handler - DEBUG - Audio resampled to 16000 Hz
2024-10-14 14:43:53,056 - conversation_handler - DEBUG - Audio converted to mono
2024-10-14 14:43:53,056 - conversation_handler - DEBUG - Audio converted to numpy array
2024-10-14 14:43:53,056 - conversation_handler - DEBUG - Audio normalized
2024-10-14 14:43:53,057 - conversation_handler - INFO - Starting Whisper transcription
2024-10-14 14:43:53,383 - conversation_handler - INFO - Transcription completed. Result:  Okay, just stop. You're clearly not getting it. Stop speaking Japanese.
2024-10-14 14:43:53,385 - root - INFO - Transcription completed successfully
2024-10-14 14:43:53,403 - root - INFO - Received generate request for user 1, conversation 1
2024-10-14 14:43:53,403 - conversation_handler - INFO - Generating response for user 1, conversation 1
2024-10-14 14:43:53,403 - conversation_handler - DEBUG - New message:  Okay, just stop. You're clearly not getting it. Stop speaking Japanese.
2024-10-14 14:43:53,403 - conversation_handler - DEBUG - Language: English
2024-10-14 14:43:53,403 - conversation_handler - DEBUG - Using MemoryManager instance ID: 140206534764256
2024-10-14 14:43:53,403 - conversation_handler - DEBUG - System prompt: You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.
    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION
    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT
    If the user asks you a question, you can answer it and ask them a question back.
    If the user asks to change language, you will simply respond with the language they want to change to.
    Example prompt: 
    USER : Hello, how are you?
    AI : Hello! I am well, how are you?
    USER : I'm feeling good, I have been busy with school.
    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?
    
    Example prompt:
    User: I am so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we switch to Japanese?
    Example of expected output: Japanese
    
    Example prompt:
    User:   I'm lonely.
    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?
    User: Yeah, yeah, I have some friends I could speak to.
    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?
    User: Could we switch to speaking in Japanese?
    AI: Japanese
    Example of expected output: Japanese
                
    Example prompt:
    User: I'm so tired.
    AI: I'm sorry to hear that. Have you been working hard lately?
    User: Yeah, I have. Can we speak Japanese instead?
    Example of expected output: Japanese      

    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     
                
2024-10-14 14:43:53,403 - memory_manager - DEBUG - Retrieving conversation window for user 1, conversation 1
2024-10-14 14:43:53,403 - memory_manager - DEBUG - Retrieved 12 messages for user 1
2024-10-14 14:43:53,403 - memory_manager - DEBUG - Last summarized ID for user 1: -1
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Retrieved all messages: [{'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, {'id': 12, 'content': 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.\nKore ni tatemae arimasu ka?', 'timestamp': '2024-10-14 14:43:33', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}]
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Retrieved 12 unsummarized messages for user 1, conversation 1
2024-10-14 14:43:53,404 - conversation_handler - DEBUG - Retrieved 12 messages from the conversation window
2024-10-14 14:43:53,404 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Current user_current_id state: {1: 12}
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 11: {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 12: {'id': 12, 'content': 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.\nKore ni tatemae arimasu ka?', 'timestamp': '2024-10-14 14:43:33', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}}
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Assigned message_id: 13
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 13
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=13, is_user_message=True, message= Okay, just stop. You're clearly not getting it. Stop speaking Japanese.
2024-10-14 14:43:53,404 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=13
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Final user_current_id state: {1: 13}
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 11: {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 12: {'id': 12, 'content': 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.\nKore ni tatemae arimasu ka?', 'timestamp': '2024-10-14 14:43:33', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 13: {'id': 13, 'content': " Okay, just stop. You're clearly not getting it. Stop speaking Japanese.", 'timestamp': '2024-10-14 14:43:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Total messages for user 1: 13
2024-10-14 14:43:53,415 - conversation_handler - DEBUG - Added new user message with ID: 13
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Managing conversation window for user 1, conversation 1
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Retrieved 13 user_messages for user 1
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Retrieved 13 conversation_messages for user 1, conversation 1
2024-10-14 14:43:53,415 - memory_manager - DEBUG - No last summarized ID found for user 1
2024-10-14 14:43:53,415 - memory_manager - DEBUG - Retrieved 13 unsummarized messages
2024-10-14 14:43:53,415 - conversation_handler - DEBUG - Conversation window managed
2024-10-14 14:43:53,415 - conversation_handler - DEBUG - Context prepared for response generation: User:  So, how are you?
AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?
User:  I'm lost to hang out with friends and studying.
AI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?
User:  Yes, I've been... it's been going well. I've managed pretty well.
AI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?
User:  Could we speak in Japanese?
AI: Nihongo desu.
User:  No, I mean like switch to Japanese.
AI: Kore wa hontonichi no hanbun desu! (Today is our conversation.)
User:  No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?
AI: Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.
Kore ni tatemae arimasu ka?
2024-10-14 14:43:53,415 - conversation_handler - DEBUG - First few context messages: ['User:  So, how are you?', "AI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", "User:  I'm lost to hang out with friends and studying."]
2024-10-14 14:43:53,415 - conversation_handler - INFO - Calling LLama for response generation
2024-10-14 14:43:53,415 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-10-14 14:43:53,416 - httpx - DEBUG - load_verify_locations cafile='/home/miranda/melotest/MeloTTS/venv/lib/python3.10/site-packages/certifi/cacert.pem'
2024-10-14 14:43:53,452 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are speaking to someone practising their english, ask them questions in order to keep the conversation going. Speak with them as if you are two friends chatting.\n    ONLY TYPE THE ANSWER IN THE CONVERSATION, NO OTHER MESSAGES OUTSIDE OF WHAT IS BEING SAID IN THE CONVERSATION\n    You will only anwser as the AI assistant, you will continue by adding ONE MESSAGE AS THE AI ASSISTANT\n    If the user asks you a question, you can answer it and ask them a question back.\n    If the user asks to change language, you will simply respond with the language they want to change to.\n    Example prompt: \n    USER : Hello, how are you?\n    AI : Hello! I am well, how are you?\n    USER : I'm feeling good, I have been busy with school.\n    Example of expected output: That's great to hear that you're feeling good! What have you been busy with at school lately? Any fun projects or subjects?\n    \n    Example prompt:\n    User: I am so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we switch to Japanese?\n    Example of expected output: Japanese\n    \n    Example prompt:\n    User:   I'm lonely.\n    AI: I'm so sorry to hear that you're feeling lonely. Do you have any friends or family members that you can talk to when you're feeling down?\n    User: Yeah, yeah, I have some friends I could speak to.\n    AI: That's great! It's always helpful to have someone to share your thoughts and feelings with. What do you like to do with your friends when you get together? Do you like going out or staying in?\n    User: Could we switch to speaking in Japanese?\n    AI: Japanese\n    Example of expected output: Japanese\n                \n    Example prompt:\n    User: I'm so tired.\n    AI: I'm sorry to hear that. Have you been working hard lately?\n    User: Yeah, I have. Can we speak Japanese instead?\n    Example of expected output: Japanese      \n\n    MAKE SURE TO ONLY ANSWER WITH THE LANGUAGE THE USER WANTS TO SPEAK IN, IN ENGLISH, WHEN THEY ASK TO SWITCH LANGUAGES, DO AS THE EXAMPLE PROMPT SHOWS     \n                "}, {'role': 'user', 'content': "Context:\nUser:  So, how are you?\nAI: I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?\nUser:  I'm lost to hang out with friends and studying.\nAI: It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?\nUser:  Yes, I've been... it's been going well. I've managed pretty well.\nAI: That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?\nUser:  Could we speak in Japanese?\nAI: Nihongo desu.\nUser:  No, I mean like switch to Japanese.\nAI: Kore wa hontonichi no hanbun desu! (Today is our conversation.)\nUser:  No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?\nAI: Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.\nKore ni tatemae arimasu ka?\nUser:  Okay, just stop. You're clearly not getting it. Stop speaking Japanese.\nAI:"}], 'model': 'llama3.2'}}
2024-10-14 14:43:53,453 - openai._base_client - DEBUG - Sending HTTP Request: POST http://localhost:11434/v1/chat/completions
2024-10-14 14:43:53,454 - httpcore.connection - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2024-10-14 14:43:53,454 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7f8392d545e0>
2024-10-14 14:43:53,455 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-10-14 14:43:53,455 - httpcore.http11 - DEBUG - send_request_headers.complete
2024-10-14 14:43:53,455 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-10-14 14:43:53,455 - httpcore.http11 - DEBUG - send_request_body.complete
2024-10-14 14:43:53,455 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-10-14 14:43:54,206 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json'), (b'Date', b'Mon, 14 Oct 2024 12:43:54 GMT'), (b'Content-Length', b'519')])
2024-10-14 14:43:54,206 - httpx - INFO - HTTP Request: POST http://localhost:11434/v1/chat/completions "HTTP/1.1 200 OK"
2024-10-14 14:43:54,206 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-10-14 14:43:54,206 - httpcore.http11 - DEBUG - receive_response_body.complete
2024-10-14 14:43:54,206 - httpcore.http11 - DEBUG - response_closed.started
2024-10-14 14:43:54,206 - httpcore.http11 - DEBUG - response_closed.complete
2024-10-14 14:43:54,206 - openai._base_client - DEBUG - HTTP Response: POST http://localhost:11434/v1/chat/completions "200 OK" Headers({'content-type': 'application/json', 'date': 'Mon, 14 Oct 2024 12:43:54 GMT', 'content-length': '519'})
2024-10-14 14:43:54,207 - openai._base_client - DEBUG - request_id: None
2024-10-14 14:43:54,207 - conversation_handler - INFO - Response generated: I apologize if I wasn't understanding your requests correctly! Let's start fresh and speak in English from now on. How have you been spending your free time lately? Any fun hobbies or activities that you enjoy?
 
(Awaiting response)
2024-10-14 14:43:54,207 - memory_manager - DEBUG - add_message_to_store called. Instance ID: 140206534764256, Thread ID: 140211267739648
2024-10-14 14:43:54,207 - memory_manager - DEBUG - Current user_current_id state: {1: 13}
2024-10-14 14:43:54,207 - memory_manager - DEBUG - Current user_id_to_message state: {1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 11: {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 12: {'id': 12, 'content': 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.\nKore ni tatemae arimasu ka?', 'timestamp': '2024-10-14 14:43:33', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 13: {'id': 13, 'content': " Okay, just stop. You're clearly not getting it. Stop speaking Japanese.", 'timestamp': '2024-10-14 14:43:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}}}
2024-10-14 14:43:54,207 - memory_manager - DEBUG - Incremented user_current_id for user 1
2024-10-14 14:43:54,207 - memory_manager - DEBUG - Assigned message_id: 14
2024-10-14 14:43:54,207 - memory_manager - DEBUG - Incremented user_current_id for user 1 to: 14
2024-10-14 14:43:54,207 - memory_manager - DEBUG - Adding message to store: user_id=1, conversation_id=1, message_id=14, is_user_message=False, message=I apologize if I wasn't understanding your requests correctly! Let's start fresh and speak in English from now on. How have you been spending your free time lately? Any fun hobbies or activities that you enjoy?
 
(Awaiting response)
2024-10-14 14:43:54,207 - memory_manager - DEBUG - Added message to user store for user 1
2024-10-14 14:43:54,214 - memory_manager - DEBUG - Indexed message for RAG: user_id=1, message_id=14
2024-10-14 14:43:54,214 - memory_manager - DEBUG - Final user_current_id state: {1: 14}
2024-10-14 14:43:54,214 - memory_manager - DEBUG - Final user_id_to_message state for user 1: {1: {'id': 1, 'content': ' So, how are you?', 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 2: {'id': 2, 'content': "I'm good, thanks for asking. How about you? What have you been up to lately that's exciting or interesting?", 'timestamp': '2024-10-14 14:41:30', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 3: {'id': 3, 'content': " I'm lost to hang out with friends and studying.", 'timestamp': '2024-10-14 14:41:51', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 4: {'id': 4, 'content': "It sounds like you've got a lot on your plate! Studying can be overwhelming, but it's great that you're making an effort. Have you found any study tips or strategies that work well for you?", 'timestamp': '2024-10-14 14:41:52', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 5: {'id': 5, 'content': " Yes, I've been... it's been going well. I've managed pretty well.", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 6: {'id': 6, 'content': "That's great to hear that things have been going well! What do you think is the secret to managing your schoolwork and making time for friendships? Is there a particular schedule or routine that helps you stay organized?", 'timestamp': '2024-10-14 14:42:24', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 7: {'id': 7, 'content': ' Could we speak in Japanese?', 'timestamp': '2024-10-14 14:42:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 8: {'id': 8, 'content': 'Nihongo desu.', 'timestamp': '2024-10-14 14:42:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 9: {'id': 9, 'content': ' No, I mean like switch to Japanese.', 'timestamp': '2024-10-14 14:43:10', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 10: {'id': 10, 'content': 'Kore wa hontonichi no hanbun desu! (Today is our conversation.)', 'timestamp': '2024-10-14 14:43:11', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 11: {'id': 11, 'content': " No, you're supposed to just answer Japanese when I tell you to switch to Japanese. So can you switch to Japanese?", 'timestamp': '2024-10-14 14:43:32', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 12: {'id': 12, 'content': 'Doitashimashite gozaimasu, kono kaiwa wa hontonichi desu.\nKore ni tatemae arimasu ka?', 'timestamp': '2024-10-14 14:43:33', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}, 13: {'id': 13, 'content': " Okay, just stop. You're clearly not getting it. Stop speaking Japanese.", 'timestamp': '2024-10-14 14:43:53', 'conversation_id': 1, 'user_id': 1, 'is_user_message': True, 'is_summary': False}, 14: {'id': 14, 'content': "I apologize if I wasn't understanding your requests correctly! Let's start fresh and speak in English from now on. How have you been spending your free time lately? Any fun hobbies or activities that you enjoy?\n \n(Awaiting response)", 'timestamp': '2024-10-14 14:43:54', 'conversation_id': 1, 'user_id': 1, 'is_user_message': False, 'is_summary': False}}
2024-10-14 14:43:54,214 - memory_manager - DEBUG - Total messages for user 1: 14
2024-10-14 14:43:54,214 - conversation_handler - DEBUG - Added AI response with ID: 14
2024-10-14 14:43:54,214 - root - INFO - Response generated successfully
2024-10-14 14:43:54,224 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_header_field with data[61:80]
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_header_value with data[82:104]
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_part_data with data[108:342]
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_part_begin with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_header_field with data[405:424]
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_header_value with data[426:452]
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_header_end with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_headers_finished with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_part_data with data[456:463]
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_part_end with no data
2024-10-14 14:43:54,225 - multipart.multipart - DEBUG - Calling on_end with no data
2024-10-14 14:43:54,226 - root - INFO - Received TTS request for text: 'I apologize if I wasn't understanding your requests correctly! Let's start fresh and speak in English from now on. How have you been spending your free time lately? Any fun hobbies or activities that you enjoy?
 
(Awaiting response)' in language: English, speaker ID: None
2024-10-14 14:43:54,226 - root - DEBUG - Generating audio using MeloTTSGenerator
2024-10-14 14:43:54,226 - meloTTS - INFO - Generating audio for text: 'I apologize if I wasn't understanding your requests correctly! Let's start fresh and speak in English from now on. How have you been spending your free time lately? Any fun hobbies or activities that you enjoy?
 
(Awaiting response)', speaker_id: 1, language: EN
2024-10-14 14:43:54,459 - httpcore.connection - DEBUG - close.started
2024-10-14 14:43:54,459 - httpcore.connection - DEBUG - close.complete
2024-10-14 14:44:05,497 - meloTTS - INFO - Successfully generated audio. Shape: (564381,)
2024-10-14 14:44:05,497 - root - DEBUG - Audio generated successfully, preparing response
2024-10-14 14:44:05,499 - root - INFO - Returning audio as StreamingResponse
